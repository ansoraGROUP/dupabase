services:
  dupabase:
    build:
      context: ../..
      dockerfile: .deploy/_shared/Dockerfile
    container_name: dupabase
    ports:
      - "${DUPABASE_PORT:-16733}:3333"
    env_file:
      - .env
    environment:
      PORT: "3333"
      HOST: "0.0.0.0"
      SITE_URL: "${SITE_URL:-http://localhost:16733}"
      DATABASE_URL: "${DATABASE_URL}"
      PLATFORM_JWT_SECRET: "${PLATFORM_JWT_SECRET}"
      MAX_CONNECTIONS_PER_DB: "${MAX_CONNECTIONS_PER_DB:-5}"
      GLOBAL_MAX_CONNECTIONS: "${GLOBAL_MAX_CONNECTIONS:-100}"
      POOL_IDLE_TIMEOUT_SECONDS: "${POOL_IDLE_TIMEOUT_SECONDS:-300}"
      DEFAULT_ENABLE_SIGNUP: "${DEFAULT_ENABLE_SIGNUP:-true}"
      DEFAULT_AUTOCONFIRM: "${DEFAULT_AUTOCONFIRM:-true}"
      DEFAULT_PASSWORD_MIN_LENGTH: "${DEFAULT_PASSWORD_MIN_LENGTH:-6}"
      ADMIN_EMAIL: "${ADMIN_EMAIL:-}"
      ADMIN_PASSWORD: "${ADMIN_PASSWORD:-}"
    networks:
      - stech_network
    restart: unless-stopped

networks:
  stech_network:
    external: true
